<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Yazming Clock</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #ffffff;
  --text: #ffd1e8;
  --glow: rgba(255, 182, 213, 0.9);
}

[data-theme="dark"] {
  --bg: #0b0b0b;
  --text: #ff8fc7;
  --glow: rgba(255, 143, 199, 0.9);
}

body {
  margin: 0;
  background: var(--bg);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.widget {
  font-family: 'Press Start 2P', monospace;
  color: var(--text);
  text-align: center;
  animation: flicker 2.8s infinite;
}

.time {
  font-size: 44px;
  text-shadow: 0 0 6px var(--glow);
}

.ampm {
  font-size: 10px;
  opacity: 0.6;
}

.divider {
  border-top: 2px dashed currentColor;
  margin: 12px 0;
  opacity: 0.6;
}

.info {
  font-size: 11px;
  line-height: 1.7;
}

.controls {
  font-size: 10px;
  opacity: 0.55;
  cursor: pointer;
  margin-top: 8px;
}

@keyframes flicker {
  0% { opacity: 1 }
  6% { opacity: .85 }
  12% { opacity: 1 }
  100% { opacity: 1 }
}
</style>
</head>

<body>
<div class="widget">
  <div class="time" id="time">10:09</div>
  <div class="ampm" id="ampm">AM</div>

  <div class="divider"></div>

  <div class="info" id="date">MON OCT 24</div>
  <div class="info" id="city">LOCATINGâ€¦</div>
  <div class="info" id="weather">--Â°</div>

  <div class="divider"></div>

  <div class="info" style="opacity:.4;">YAZMING made this</div>

  <div class="controls" onclick="toggleTheme()">â™¡ theme</div>
  <div class="controls" onclick="toggleUnit()">â™¡ Â°F / Â°C</div>
</div>

<script>
let unit = "F"; // default unit
let lastTempC = null;
let lastCode = null;

/* ðŸŒ— Theme toggle */
function toggleTheme() {
  document.documentElement.dataset.theme =
    document.documentElement.dataset.theme === "dark" ? "light" : "dark";
}

/* ðŸŒ¡ Temp unit toggle */
function toggleUnit() {
  unit = unit === "F" ? "C" : "F";
  updateWeatherDisplay();
}

/* ðŸ•’ Clock */
function updateClock() {
  const now = new Date();

  const time = now.toLocaleTimeString([], {
    hour: "numeric",
    minute: "2-digit",
    hour12: true
  });

  const [t, p] = time.split(" ");
  document.getElementById("time").textContent = t;
  document.getElementById("ampm").textContent = p;

  document.getElementById("date").textContent =
    now.toDateString().toUpperCase().replace(",", "");
}

updateClock();
setInterval(updateClock, 1000);

/* ðŸŒ¦ Weather icons */
const icons = {
  0: "â˜€",
  1: "ðŸŒ¤",
  2: "â›…",
  3: "â˜",
  45: "ðŸŒ«",
  48: "ðŸŒ«",
  51: "ðŸŒ§",
  61: "ðŸŒ§",
  71: "â„",
  95: "â›ˆ"
};

/* ðŸŒ¡ Update temp display */
function updateWeatherDisplay() {
  if (lastTempC === null) return;

  let temp =
    unit === "F"
      ? Math.round(lastTempC * 9/5 + 32)
      : Math.round(lastTempC);

  document.getElementById("weather").textContent =
    `${icons[lastCode] || "â™¡"} ${temp}Â°${unit}`;
}

/* ðŸŒ Location + Weather (Open-Meteo) */
navigator.geolocation.getCurrentPosition(async pos => {
  const lat = pos.coords.latitude;
  const lon = pos.coords.longitude;

  // City
  const geoRes = await fetch(
    `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&count=1`
  );
  const geo = await geoRes.json();
  document.getElementById("city").textContent =
    geo.results?.[0]?.name?.toUpperCase() || "UNKNOWN";

  // Weather
  const weatherRes = await fetch(
    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&timezone=auto`
  );
  const weather = await weatherRes.json();

  lastTempC = weather.current.temperature_2m;
  lastCode = weather.current.weather_code;

  updateWeatherDisplay();

  // ðŸŽ¨ Auto theme logic
  const hour = new Date().getHours();
  if (hour >= 18 || hour < 6 || lastCode >= 3) {
    document.documentElement.dataset.theme = "dark";
  }
});
</script>
</body>
</html>
